<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Sorpresa üéÅ</title>
  <meta name="robots" content="noindex, nofollow">
  <style>
    html,body { height: 100%; }
    body {
      margin: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      color: #fff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    .frame {
      width: 100%;
      max-width: 900px;
      padding: 12px;
      box-sizing: border-box;
      text-align: center;
    }
    img#meme {
      width: 100%;
      max-height: calc(100vh - 120px);
      object-fit: contain;
      background: #111;
      display: block;
      margin: 0 auto;
    }
    button {
      margin-top: 16px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #fff;
      color: #000;
    }
    .msg {
      margin-top: 8px;
      font-size: 14px;
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="frame" aria-live="polite">
    <img id="meme" alt="Meme casuale" role="img" loading="lazy">
    <div>
      <button id="altro" type="button">Altro meme</button>
    </div>
    <div class="msg" id="status" aria-atomic="true"></div>
  </div>

  <script>
    const totaleImmagini = 107; // impostalo al numero reale di file presenti
    const img = document.getElementById("meme");
    const btn = document.getElementById("altro");
    const status = document.getElementById("status");
    const estensioni = ['jpeg','jpg','png']; // ordine di tentativi

    function logStatus(t) {
      if (status) status.textContent = t;
      console.log(t);
    }

    async function existsUrl(url) {
      try {
        const r = await fetch(url, { method: 'HEAD' });
        return r.ok;
      } catch (e) {
        return false;
      }
    }

    async function setImgSrcIfExists(numero) {
      const nome = String(numero);
      const baseRel = `./${nome}`; // immagini nella stessa cartella di index.html
      for (const ext of estensioni) {
        const url = `${baseRel}.${ext}`;
        logStatus('Controllo: ' + url);
        if (await existsUrl(url)) {
          img.src = url;
          img.alt = `Meme numero ${numero}`;
          logStatus('Immagine caricata: ' + url);
          return true;
        }
      }
      // nessuna estensione trovata
      img.removeAttribute('src');
      img.alt = 'Immagine non disponibile';
      logStatus('Immagine non disponibile per: ' + baseRel + ' (provate tutte le estensioni).');
      return false;
    }

    function nuovoMeme() {
      const numeroRandom = Math.floor(Math.random() * totaleImmagini) + 1;
      setImgSrcIfExists(numeroRandom);
    }

    if (btn) btn.addEventListener('click', nuovoMeme);

    // carica subito un meme
    nuovoMeme();
  </script>
</body>
</html>
